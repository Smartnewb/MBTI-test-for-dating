# 아키텍처 문서

이 문서는 달빛 연애 연구소 프로젝트의 아키텍처에 대한 설명입니다.

## 시스템 아키텍처

```
+------------------+     +------------------+     +------------------+
|                  |     |                  |     |                  |
|  클라이언트 (Next.js) |---->|  Supabase API    |---->|  Supabase 데이터베이스 |
|                  |     |                  |     |                  |
+------------------+     +------------------+     +------------------+
```

## 프론트엔드 아키텍처

### 디렉토리 구조

```
src/
├── app/                  # Next.js App Router 구조
│   ├── components/       # 공통 컴포넌트
│   ├── hooks/            # 커스텀 훅
│   ├── contexts/         # Context API
│   ├── utils/            # 유틸리티 함수
│   ├── test/             # 테스트 페이지
│   ├── result/           # 결과 페이지
│   ├── layout.js         # 루트 레이아웃
│   └── page.js           # 홈페이지
└── styles/               # 스타일 관련 파일
```

### 주요 컴포넌트

- **TarotCard**: 타로 카드 디자인의 컨테이너 컴포넌트
- **ProgressBar**: 테스트 진행 상태를 표시하는 컴포넌트
- **Providers**: 전역 상태 및 테마 제공자 컴포넌트

### 상태 관리

- **useMbtiTest**: MBTI 테스트 관련 상태 및 로직을 관리하는 커스텀 훅
- **React Context API**: 전역 상태 관리를 위한 컨텍스트 제공

## 백엔드 아키텍처

### Supabase 서비스

- **인증 서비스**: 사용자 인증 및 세션 관리
- **데이터베이스**: PostgreSQL 기반 데이터 저장소
- **스토리지**: 이미지 및 파일 저장소

### 데이터베이스 스키마

- **Questions**: MBTI 테스트 질문 및 선택지 정보
- **UserResponses**: 사용자의 테스트 응답 데이터
- **MBTITypes**: 16가지 MBTI 유형 정보 및 설명
- **Compatibility**: MBTI 유형 간 궁합 정보
- **Users**: 사용자 정보 (선택적 로그인 시)

## 데이터 흐름

1. 사용자가 테스트 페이지에 접속
2. 질문 데이터를 Supabase에서 로드
3. 사용자가 질문에 응답
4. 응답 데이터를 클라이언트에서 처리하여 MBTI 유형 결정
5. 결과 페이지에서 해당 MBTI 유형 정보 및 궁합 정보 표시
6. (선택적) 사용자 응답 및 결과를 Supabase에 저장

## 인증 흐름

1. 사용자가 로그인/회원가입 선택
2. Supabase Auth를 통한 인증 처리
3. 인증 성공 시 JWT 토큰 발급
4. 토큰을 사용하여 인증된 API 요청 수행

## 배포 아키텍처

- **프론트엔드**: Vercel을 통한 Next.js 애플리케이션 배포
- **백엔드**: Supabase 클라우드 서비스 활용
- **CI/CD**: GitHub Actions를 통한 자동 배포 파이프라인

## 성능 최적화

- **정적 생성**: 가능한 페이지는 정적 생성(SSG)을 통해 성능 최적화
- **이미지 최적화**: Next.js Image 컴포넌트를 활용한 이미지 최적화
- **코드 분할**: 동적 임포트를 통한 코드 분할 및 지연 로딩
- **캐싱**: Tanstack Query를 활용한 데이터 캐싱

## 보안 고려사항

- **Row Level Security (RLS)**: Supabase 데이터베이스의 RLS를 통한 데이터 접근 제어
- **환경 변수**: 민감한 정보는 환경 변수로 관리
- **CORS 설정**: 적절한 CORS 설정을 통한 API 보안
- **입력 검증**: 클라이언트 및 서버 측 입력 검증
